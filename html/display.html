<html>

<head>
    <!--<script src="https://raw.githubusercontent.com/a-weeb-programmer/libcute/main/src/libcute.h"></script> lol-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <script rel="preconnect" src="./src/jssh.js" crossorigin></script>
    <script rel="preconnect" src="./src/window-utils.js" crossorigin></script>
    <script rel="preconnect" src="./src/common.js" crossorigin></script>
    <link href="https://fonts.googleapis.com/css2?family=Flow+Circular&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <title>~nya</title>
    <link rel="stylesheet" href="src/display.css">
    <script>
        function compare(a, b) {
            if (a.left < b.left) {
                return -1;
            }
            if (a.left > b.left) {
                return 1;
            }
            return 1;
        }
        let bar_items_left = []
        function load_bar() {
            document.getElementById("bar-menu").onclick = ((ev) => {
                if (document.getElementById("bar-menu-root").style.display == "block")
                    document.getElementById("bar-menu-root").style.display = "none"
                else
                    document.getElementById("bar-menu-root").style.display = "block"
            })
            let items = document.getElementById("bar-menu-root").children
            for (let item = 0; item != items.length; item++) {
                //console.log(items.item(item))
                if (items.item(item).className == "bar-menu-item") {
                    let i_c = items.item(item).children
                    for (let i = 0; i != i_c.length; i++) {
                        let id = i_c.item(i)
                        if (id.className == "bar-menu-more-root") {

                            let t_s = new jssh(fs, '/', document.getElementsByClassName('window').length, 'null', 'null')
                            let dd = (t_s.set_wd(items.item(item).getAttribute("dir")))
                            if (dd[0] == undefined) { //item is null
                                id.innerHTML = '';
                                items.item(item).onmouseover = null
                                break
                                //! TODO: don't show bar if dir is empty or null
                            }
                            /*
                            <div class="bar-menu-item" id="bar-menu-favorites"><img class="bar-menu-image"
                                src="./src/img/notepad.png">
                            <div class="bar-menu-text">Notepad--</div>
                        </div>
                            */
                            id.innerHTML = ''
                            let ins = ""
                            for (let ite = 0; ite != dd.length; ite++) {
                                if (dd[ite].dir == false) {
                                    let icon = ""
                                    ins += `<div class="bar-menu-item" onclick="shortcut('${items.item(item).getAttribute("dir") + dd[ite].name}');close_menu();" id="bar-menu-${dd[ite].name}">`
                                    //if (dd[ite].icon)
                                    //icon = `<img class="bar-menu-image" src="${dd[ite].icon}">`
                                    //else {

                                    for (let l of dd[ite].content.split("\n")) {
                                        if (l.split(" ")[0] == "meta") {
                                            let tem = l.split(" ")
                                            tem.splice(0, 1);
                                            tem = tem.join(" ")
                                            //console.log(tem)
                                            tem = tem.split(",")
                                            //console.log(tem)
                                            for (let tw of tem) {
                                                if (tw.trim().split(" ")[0] == "icon") {
                                                    icon = `<img class="bar-menu-image" src="${tw.trim().split(" ")[1]}">`
                                                }
                                            }
                                            /*if (l.split(" ")[1] == "icon") {
                                                icon = `<img class="bar-menu-image" src="${l.split(" ")[2]}">`
                                            }*/

                                        }
                                    }
                                    ins += icon
                                    //}
                                    ins += `<div class="bar-menu-text">${dd[ite].name}</div></div>`


                                    //console.log(id.children.item(ite))
                                }
                            }
                            id.innerHTML = ins;
                            items.item(item).onmouseover = ((ev) => {
                                id.style.display = "block"
                                items.item(item).onmouseout = ((ev) => {
                                    id.style.display = "none"
                                })
                            })
                            break;
                        }
                    }
                }
            }
            let bar = document.getElementById("bar-items")
            let windows = document.getElementsByClassName("window")
            let put = ""
            let last_left = 0;
            let temp = []
            bar.innerHTML = ""
            for (let i = 0; i != windows.length; i++) {
                bar.innerHTML += "<div style='left:" + last_left + ";' id='" + windows.item(i).id + "-bar' class='bar-item'>" + windows.item(i).getAttribute("window-name") + "</div>"
                temp.push({ left: last_left, id: windows.item(i).id, width: bar.children.item(bar.children.length - 1).clientWidth + 5 })
                last_left += bar.children.item(bar.children.length - 1).clientWidth + 5


            }
            bar_items_left = temp;
            //bar.innerHTML = put;
            for (let i = 0; i != bar.children.length; i++) {
                let elemy = bar.children.item(i)
                for (let ii = 0; ii != windows.length; ii++) {
                    if (windows.item(ii).id + "-bar" == elemy.id) {
                        //let px = 0, py = 0;

                        elemy.onmousedown = ((ev) => {
                            for (let iii = 0; iii != windows.length; iii++) {
                                windows.item(iii).style.zIndex = 0;
                                bar.children.item(iii).style.zIndex = 0;
                            }
                            document.body.style.cursor = "grabbing"
                            windows.item(ii).style.zIndex = 1
                            bar.children.item(ii).style.zIndex = 1;
                            document.onmouseup = ((ev) => {
                                document.onmousemove = null
                                document.body.style.cursor = ''
                                temp = [];
                                for (let iii = 0; iii != bar.children.length; iii++) {
                                    temp.push({ left: bar.children.item(iii).offsetLeft, id: bar.children.item(iii).id, width: bar.children.item(iii).clientWidth + 5 })
                                }
                                temp = temp.sort(compare)
                                bar_items_left = []
                                let len = 0
                                for (let item in temp) {
                                    for (let iii = 0; iii != bar.children.length; iii++) {
                                        if (bar.children.item(iii).id == temp[item].id) {
                                            bar.children.item(iii).style.left = len
                                            bar_items_left.push({ left: len, id: bar.children.item(iii).id, width: bar.children.item(iii).clientWidth + 5 })
                                            len += temp[item].width

                                        }
                                    }

                                }

                            })
                            let px = 0;
                            document.onmousemove = ((evm) => {
                                if ((elemy.parentElement.clientWidth * (evm.clientX / elemy.parentElement.clientWidth) - (elemy.parentElement.offsetLeft + document.getElementById("root").offsetLeft + (elemy.clientWidth / 2))) > 0) {
                                    if ((elemy.parentElement.clientWidth * (evm.clientX / elemy.parentElement.clientWidth) - (elemy.parentElement.offsetLeft + document.getElementById("root").offsetLeft - (elemy.clientWidth / 2))) < elemy.parentElement.clientWidth - 5) {
                                        elemy.style.left = (elemy.parentElement.clientWidth * (evm.clientX / elemy.parentElement.clientWidth) - (elemy.parentElement.offsetLeft + document.getElementById("root").offsetLeft + (elemy.clientWidth / 2)))
                                    } else {
                                        elemy.style.left = elemy.parentElement.clientWidth - elemy.clientWidth - 5
                                    }
                                } else {
                                    elemy.style.left = 0;
                                }
                                //console.log((px - evm.clientX), px, evm.clientX, m)

                            })
                        })
                    }
                }
            }
        }
        let minx = 150;
        let miny = 150;
      
        function window_create(uid, name, content, options = {}) {
            //let promise = new Promise((res, rej) => {
                let lines = content.split("</br>").length
                let a = ''
                let size = (options.width != undefined && options.height != undefined) ? ("width:" + options.width + "px;height:" + options.height + "px;") : ("width:" + Math.max(document.body.clientWidth * .36, minx) + "px;height:" + Math.max(miny, document.body.clientHeight * .30) + "px;");
                let pos = (options.left != undefined && options.top != undefined) ? ("left:" + options.left + "px;top:" + options.top + "px;") : ("left:0px;top:0px;");
                a += "<div id='" + uid + "-root' class='window' style=\"" + size + pos + "position:absolute;\" window-name='" + name + "'>"
                //console.log(document.getElementById(uid).attributes["window-name"].value)
                a += "<div id='" + uid + "-head' class='head-border' window-name='" + name + "'> <div style='color:fdffff'>" + name + "</div>"
                a += "<div id='" + uid + "-close' class='close-button' window-name='" + name + "'>" + `<svg draggable="false" xmlns="http://www.w3.org/2000/svg" style="position:absolute;left:-3px;top:0px;" xmlns:xlink="http://www.w3.org/1999/xlink" width="23px" height="20px" viewBox="0 0 23 20" version="1.1">
<g id="surface1">
<path style=" stroke:none;fill-rule:evenodd;fill:rgb(2.745098%,3.137255%,2.745098%);fill-opacity:1;" d="M 8.476562 6.042969 C 9.042969 6.042969 9.613281 6.042969 10.179688 6.042969 C 10.179688 6.332031 10.179688 6.625 10.179688 6.914062 C 10.464844 6.914062 10.746094 6.914062 11.03125 6.914062 C 11.03125 7.203125 11.03125 7.492188 11.03125 7.78125 C 11.597656 7.78125 12.167969 7.78125 12.734375 7.78125 C 12.734375 7.492188 12.734375 7.203125 12.734375 6.914062 C 13.019531 6.914062 13.304688 6.914062 13.585938 6.914062 C 13.585938 6.625 13.585938 6.332031 13.585938 6.042969 C 14.15625 6.042969 14.722656 6.042969 15.289062 6.042969 C 15.289062 6.332031 15.289062 6.625 15.289062 6.914062 C 15.007812 6.914062 14.722656 6.914062 14.4375 6.914062 C 14.4375 7.203125 14.4375 7.492188 14.4375 7.78125 C 14.15625 7.78125 13.871094 7.78125 13.585938 7.78125 C 13.585938 8.074219 13.585938 8.363281 13.585938 8.652344 C 13.304688 8.652344 13.019531 8.652344 12.734375 8.652344 C 12.734375 8.941406 12.734375 9.230469 12.734375 9.523438 C 13.019531 9.523438 13.304688 9.523438 13.585938 9.523438 C 13.585938 9.8125 13.585938 10.101562 13.585938 10.390625 C 13.871094 10.390625 14.15625 10.390625 14.4375 10.390625 C 14.4375 10.679688 14.4375 10.972656 14.4375 11.261719 C 14.722656 11.261719 15.007812 11.261719 15.289062 11.261719 C 15.289062 11.550781 15.289062 11.839844 15.289062 12.128906 C 14.722656 12.128906 14.15625 12.128906 13.585938 12.128906 C 13.585938 11.839844 13.585938 11.550781 13.585938 11.261719 C 13.304688 11.261719 13.019531 11.261719 12.734375 11.261719 C 12.734375 10.972656 12.734375 10.679688 12.734375 10.390625 C 12.167969 10.390625 11.597656 10.390625 11.03125 10.390625 C 11.03125 10.679688 11.03125 10.972656 11.03125 11.261719 C 10.746094 11.261719 10.464844 11.261719 10.179688 11.261719 C 10.179688 11.550781 10.179688 11.839844 10.179688 12.128906 C 9.613281 12.128906 9.042969 12.128906 8.476562 12.128906 C 8.476562 11.839844 8.476562 11.550781 8.476562 11.261719 C 8.761719 11.261719 9.042969 11.261719 9.328125 11.261719 C 9.328125 10.972656 9.328125 10.679688 9.328125 10.390625 C 9.613281 10.390625 9.894531 10.390625 10.179688 10.390625 C 10.179688 10.101562 10.179688 9.8125 10.179688 9.523438 C 10.464844 9.523438 10.746094 9.523438 11.03125 9.523438 C 11.03125 9.230469 11.03125 8.941406 11.03125 8.652344 C 10.746094 8.652344 10.464844 8.652344 10.179688 8.652344 C 10.179688 8.363281 10.179688 8.074219 10.179688 7.78125 C 9.894531 7.78125 9.613281 7.78125 9.328125 7.78125 C 9.328125 7.492188 9.328125 7.203125 9.328125 6.914062 C 9.042969 6.914062 8.761719 6.914062 8.476562 6.914062 C 8.476562 6.625 8.476562 6.332031 8.476562 6.042969 Z M 8.476562 6.042969 "/>
</g>
</svg></div></div>`
                if (options.resize != false && options.resize != "false") {
                    a += "<div id='" + uid + "-resize-n' class='resize-n'></div>"
                    a += "<div id='" + uid + "-resize-s' class='resize-s'></div>"
                    a += "<div id='" + uid + "-resize-e' class='resize-e'></div>"
                    a += "<div id='" + uid + "-resize-w' class='resize-w'></div>"
                }
                a += "<div style='height:25px;'></div>"
                a += "<div id='" + uid + "-content-root' class='content-root' style='overflow:scroll;height:calc(100% - 26px);width:100%'>"

                a += "<div id='" + uid + "-content-content' class='content-content'>" + content + "</div>"
                
                a += "</div>"
                if (options.resize != false && options.resize != "false") {
                    a += "<div id='" + uid + "-resize-ne' class='resize-ne'></div>"
                    a += "<div id='" + uid + "-resize-nw' class='resize-nw'></div>"
                    a += "<div id='" + uid + "-resize-sw' class='resize-sw'></div>"
                    a += "<div id='" + uid + "-resize-es' class='resize-es'></div>"
                }
               a += "</div>"
                //console.log(a)
                //document.getElementById("root").append(a)
                appendHtml(document.getElementById("root"),a)
                if (options.scroll != false && options.scroll != "false") {
                    //a += "<div id='" + uid + "-content-scrollbar' class='scrollbar'><div id='" + uid + "-content-scrollbar-point' class='scrollbar-point'></div>"
                    //a += "</div>"
                  util.scrollbar(uid,'content-scroll',document.getElementById(uid + "-content-root"),document.getElementById(uid + "-content-content"))
                }
                //console.log(document.getElementById(uid + "-content-root").clientHeight / (document.getElementById(uid + "-content-content").clientHeight / document.getElementById(uid + "-content-root").clientHeight))

                //console.log(document.getElementById(uid + "-content-scrollbar-point"))
                refresh_windows()
                //res()
            //})
            //return promise
        }
        function refresh_windows() {
            load_bar()
            
            //let elems = document.getElementsByClassName("window")
          let elems = document.getElementById("root").children
            for (let i = 0; i != elems.length; i++) {
                if(elems.item(i).className!='window')
                  continue
                let uid = elems.item(i).id.split("-")[0]
              if(null!=procs[uid] && null!=procs[uid].refresh)
                                    procs[uid].refresh()
                try {
                    document.getElementById(uid + "-content-scrollbar-point").style.height = (document.getElementById(uid + "-content-root").clientHeight / (document.getElementById(uid + "-content-content").clientHeight / document.getElementById(uid + "-content-root").clientHeight)) + "px"

                    if (document.getElementById(uid + "-content-scrollbar-point").clientHeight >= document.getElementById(uid + "-content-root").clientHeight) {
                        document.getElementById(uid + "-content-scrollbar").style.display = 'none'
                    }
                    else {
                        if (document.getElementById(uid + "-content-scrollbar").style.display == 'none') {
                            document.getElementById(uid + "-content-scrollbar").style.display = 'block'
                            if (document.getElementById(uid + "-content-scrollbar-point").clientHeight >= document.getElementById(uid + "-content-root").clientHeight) {
                                document.getElementById(uid + "-content-scrollbar").style.display = 'none'
                            }
                        }
                    }
                } catch (e) { }
              //continue
                //let elem = elems.item(i).children[0]
                let elec = elems.item(i).children
                let elem
                //console.log(elec)
                for (let ii = 0; ii != elec.length; ii++) {
                    if (elec.item(ii).className == 'head-border') {
                        elem = elec.item(ii)
                        for (let iii = 0; iii != elem.children.length; iii++) {
                            if (elem.children.item(iii).className == "close-button") {
                                //console.log(elem.children.item(iii))
                                let ii = elems.item(i)
                                elem.children.item(iii).onmousedown = ((ev) => {
                                    //console.log(elems.item(i))
                                    //onkill.apply(this)
                                    if(null!=procs[uid] && null!=procs[uid].remove)
                                      procs[uid].remove()
                                    delete procs[elem.id.split("-")[0]]
                                    ii.remove()
                                    load_bar()
                                })
                                break
                            }
                        }
                        break
                    }
                }
                let elep = elems.item(i)
                let px = 0, py = 0;

                if (elem.className == 'head-border') {
                    elemhb = elem
                    elem.onmousedown = ((ev) => {

                        for (let i = 0; i != elems.length; i++) {
                            elems.item(i).style.zIndex = 0;
                        }
                        elep.style.zIndex = 1
                        document.body.style.cursor = 'grabbing'
                        elemhb.style.cursor = 'grabbing'
                        px = ev.clientX
                        py = ev.clientY
                        document.body.style.userSelect = "none"
                        document.onmouseup = ((evu) => {
                            document.body.style.userSelect = "unset"
                            document.onmousemove = null
                            document.onmouseup = null
                            document.body.style.cursor = ''
                            elemhb.style.cursor = 'grab'
                        })
                        document.onmousemove = ((evm) => {
                            //console.log(elem.id)
                            elep.style.left = (elep.offsetLeft - (px - evm.clientX)) + "px"
                            elep.style.top = (elep.offsetTop - (py - evm.clientY)) + "px"
                            px = (evm.clientX)
                            py = (evm.clientY)
                        })
                    })
                }


                ['resize-s', 'resize-n', 'resize-e', 'resize-w', 'resize-ne', 'resize-nw', 'resize-sw', 'resize-es'].forEach((sel) => {
                    for (let ii = 0; ii != elec.length; ii++) {
                        if (elec.item(ii).className == sel) {
                            elem = elec.item(ii)
                            break
                        }
                    }
                    if (elem.className == sel) {
                        elem.onmousedown = ((ev) => {
                            px = ev.clientX
                            py = ev.clientY
                            if (sel == 'resize-s' || sel == 'resize-n')
                                document.body.style.cursor = 'ns-resize'
                            else if (sel == 'resize-e' || sel == 'resize-w')
                                document.body.style.cursor = 'ew-resize'
                            else if (sel == 'resize-ne')
                                document.body.style.cursor = 'ne-resize'
                            else if (sel == 'resize-nw')
                                document.body.style.cursor = 'nw-resize'
                            else if (sel == 'resize-sw')
                                document.body.style.cursor = 'sw-resize'
                            else if (sel == 'resize-es')
                                document.body.style.cursor = 'se-resize'
                            document.body.style.userSelect = "none"
                            document.onmouseup = ((evu) => {
                                document.body.style.userSelect = "unset"
                                document.onmousemove = null
                                document.onmouseup = null
                                document.body.style.cursor = ''

                            })
                            document.onmousemove = ((evm) => {
                                if (sel == 'resize-s' || sel == 'resize-es' || sel == 'resize-sw')
                                    if ((parseInt(elep.style.height.replace("px", "")) + (evm.clientY - py)) > miny) {
                                        elep.style.height = (parseInt(elep.style.height.replace("px", "")) + (evm.clientY - py)) + "px"
                                    } if (sel == 'resize-n' || sel == 'resize-nw' || sel == 'resize-ne') {
                                        if ((parseInt(elep.style.height.replace("px", "")) - (evm.clientY - py)) > miny) {
                                            elep.style.top = (elep.offsetTop - (py - evm.clientY)) + "px"
                                            elep.style.height = (parseInt(elep.style.height.replace("px", "")) - (evm.clientY - py)) + "px"
                                            //console.log(elem.parentElement.parentElement.parentElement)

                                            //document.getElementById(uid + "-content-scrollbar-point").style.height = (document.getElementById(uid + "-content-root").clientHeight / (document.getElementById(uid + "-content-content").clientHeight / document.getElementById(uid + "-content-root").clientHeight)) + "px"
                                        }
                                    }
                                if (sel == 'resize-e' || sel == 'resize-es' || sel == 'resize-ne')
                                    if ((parseInt(elep.style.width.replace("px", "")) + (evm.clientX - px)) > minx) {
                                        elep.style.width = (parseInt(elep.style.width.replace("px", "")) + (evm.clientX - px)) + "px"
                                    } if (sel == 'resize-w' || sel == 'resize-nw' || sel == 'resize-sw') {
                                        //console.log((parseInt(elep.style.width.replace("px", "")) - (evm.clientX - px)))
                                        if ((parseInt(elep.style.width.replace("px", "")) - (evm.clientX - px)) > minx) {
                                            elep.style.left = (elep.offsetLeft - (px - evm.clientX)) + "px"
                                            elep.style.width = (parseInt(elep.style.width.replace("px", "")) - (evm.clientX - px)) + "px"
                                        }
                                    }
                                //
                                //if (sel == 'resize-s' || sel == 'resize-n' || ) {
                                if(null!=procs[uid] && null!=procs[uid].refresh)
                                    procs[uid].refresh()
                                /*
                                for (let iii = 0; iii != elem.parentElement.parentElement.parentElement.children.length; iii++) {
                                    //console.log(elem.parentElement.parentElement.parentElement.children.item(iii).className)
                                    if (elem.parentElement.parentElement.parentElement.children.item(iii).className == "content-root") {

                                        for (let iiii = 0; iiii != elem.parentElement.parentElement.parentElement.children.item(iii).children.length; iiii++) {
                                            if (elem.parentElement.parentElement.parentElement.children.item(iii).children.item(iiii).className == "scrollbar") {
                                                for (let iiiii = 0; iiiii != elem.parentElement.parentElement.parentElement.children.item(iii).children.item(iiii).children.length; iii++) {
                                                    if (elem.parentElement.parentElement.parentElement.children.item(iii).children.item(iiii).children.item(iiiii).className == "scrollbar-point") {
                                                        for (let iiiiii = 0; iiiiii != elem.parentElement.parentElement.parentElement.children.item(iii).children.length; iiiiii++) {

                                                            if (elem.parentElement.parentElement.parentElement.children.item(iii).children.item(iiiiii).className == "content-content") {

                                                                if (elem.parentElement.parentElement.parentElement.children.item(iii).clientHeight / (elem.parentElement.parentElement.parentElement.children.item(iii).children.item(iiiiii).clientHeight / elem.parentElement.parentElement.parentElement.children.item(iii).clientHeight) < elem.parentElement.parentElement.parentElement.children.item(iii).clientHeight) {
                                                                    elem.parentElement.parentElement.parentElement.children.item(iii).children.item(iiii).style.display = "block"
                                                                    elem.parentElement.parentElement.parentElement.children.item(iii).children.item(iiii).children.item(iiiii).style.height = (elem.parentElement.parentElement.parentElement.children.item(iii).clientHeight / (elem.parentElement.parentElement.parentElement.children.item(iii).children.item(iiiiii).clientHeight / elem.parentElement.parentElement.parentElement.children.item(iii).clientHeight))
                                                                    if (elem.parentElement.parentElement.parentElement.children.item(iii).children.item(iiii).children.item(iiiii).offsetTop > elem.parentElement.parentElement.parentElement.children.item(iii).children.item(iiii).clientHeight - elem.parentElement.parentElement.parentElement.children.item(iii).children.item(iiii).children.item(iiiii).clientHeight) {
                                                                        elem.parentElement.parentElement.parentElement.children.item(iii).children.item(iiii).children.item(iiiii).style.top = elem.parentElement.parentElement.parentElement.children.item(iii).children.item(iiii).clientHeight - elem.parentElement.parentElement.parentElement.children.item(iii).children.item(iiii).children.item(iiiii).clientHeight
                                                                    }
                                                                    //elem.parentElement.parentElement.parentElement.children.item(iii).children.item(iiii).children.item(iiiii).style.top = Math.min(elem.parentElement.parentElement.parentElement.children.item(iii).children.item(iiii).children.item(iiiii).style.top, elem.parentElement.parentElement.parentElement.children.item(iii).clientHeight)
                                                                } else {
                                                                    elem.parentElement.parentElement.parentElement.children.item(iii).children.item(iiii).style.display = "none"
                                                                }
                                                                break
                                                            }
                                                        }

                                                        break
                                                    }
                                                }
                                                break
                                            }
                                        }
                                        break
                                    }
                                }*/
                                //}
                                py = (evm.clientY)
                                px = (evm.clientX)

                            })
                        })
                    }
                })
              /*
                let temp
                let scrolling = false
                for (let ii = 0; ii != elec.length; ii++) {

                    if (elec.item(ii).className == 'content-root') {
                        //console.log(elec.item(ii).className)
                        temp = elec.item(ii).children
                        for (let iii = 0; iii != temp.length; iii++) {
                            //console.log(temp.item(iii).className)
                            if (temp.item(iii).className == 'scrollbar') {
                                temp = temp.item(iii).children
                                for (let iiii = 0; iiii != temp.length; iiii++) {
                                    //console.log(temp.item(iiii).className)
                                    if (temp.item(iiii).className == 'scrollbar-point') {
                                        elem = temp.item(iiii)

                                        for (let iiiii = 0; iiiii != elec.item(ii).children.length; iiiii++) {

                                            if (elec.item(ii).children.item(iiiii).className == 'content-content') {
                                              
                                              
                                                //console.log(elec.item(ii).children.item(iiiii), "hi")
                                                con = elec.item(ii).children.item(iiiii)
                                                elec.item(ii).onscroll = ((ev) => {
                                                    if (!scrolling) {
                                                        let aaaa = (elec.item(ii).clientHeight - elem.clientHeight)
                                                        let scro = (elec.item(ii).scrollTop / (elec.item(ii).scrollHeight - elec.item(ii).clientHeight))
                                                        //console.log(aaaa, (elec.item(ii).scrollHeight - elec.item(ii).clientTop))
                                                        elem.style.top = scro * aaaa
                                                    }
                                                })
                                                elem.onmousedown = ((ev) => {
                                                    let thi = elec.item(ii).children.item(iiiii)
                                                    let eel = temp.item(iiii)
                                                    document.body.style.cursor = 'grabbing'
                                                    eel.style.cursor = 'grabbing'
                                                    py = ev.clientY
                                                    document.body.style.userSelect = "none"
                                                    document.onmouseup = ((evu) => {
                                                        document.body.style.userSelect = "unset"
                                                        document.onmousemove = null
                                                        document.onmouseup = null
                                                        document.body.style.cursor = ''
                                                        eel.style.cursor = 'grab'
                                                        scrolling = false
                                                    })
                                                    document.onmousemove = ((evm) => {
                                                        scrolling = true
                                                        let z = (eel.offsetTop - (py - evm.clientY))
                                                        //let b = (elem.clientHeight - elem.offsetTop - (py - evm.clientY))
                                                        //console.log(elem.clientHeight/2 - elem.offsetTop - (py - evm.clientY))
                                                        //console.log(z, elem.parentElement.clientHeight - elem.clientHeight)
                                                        if (z >= 0 && z < eel.parentElement.clientHeight - eel.clientHeight) {
                                                            eel.style.top = z
                                                            thi.parentElement.scrollTop = ((z / (eel.parentElement.clientHeight - eel.clientHeight)) * (thi.scrollHeight - eel.parentElement.clientHeight + 24))
                                                        } else {
                                                            if (z < elem.parentElement.clientHeight - elem.clientHeight) {
                                                                elem.style.top = 0
                                                            } else {
                                                                elem.style.top = elem.parentElement.clientHeight - elem.clientHeight
                                                            }
                                                        }
                                                        py = (evm.clientY)
                                                    })
                                                })
                                                break
                                            }
                                        }

                                        break
                                    }
                                }
                                break
                            }
                        }
                        break
                    }
                }
                px = 0, py = 0;

                if (elem.className == 'scrollbar-point') {


                }*/



            }



        }
        function auto_resize(i) {

            i.style.height = (i.value.split("\n").length + 1) * 25
            refresh_windows()
        }
        let procs = {}
        function exe_com(a) {
            let exe;
            let id = a.parentElement.id.split("-")[0]

            let a_c = a.children;
            for (let i = 0; i != a_c.length; i++) {
                if (a_c.item(i).id == id + "-line") {
                    let inp = a_c.item(i).id
                    let a_p_c = a.parentElement.children
                    for (let ii = 0; ii != a_p_c.length; ii++) {
                        if (a_p_c.item(ii).id == id + "-history") {
                            let his = a_p_c.item(ii).id
                            if(procs[id] == undefined)
                              procs[id] = {}
                            if (procs[id].comm == undefined){
                                
                                procs[id].comm = new jssh(fs, "/", id, inp, his, window_create)
                            }
                          //console.log(procs)
                          //return
                            procs[id].comm.ex()
                            refresh_windows()
                            a.parentElement.parentElement.scrollTop = a.parentElement.parentElement.scrollHeight
                            break
                        }
                    }
                    break
                }
            }
        }
        function req(url) {
            let prom = new Promise((resolve, reject) => {
                var xhr = new XMLHttpRequest();
                xhr.open('GET', url, true);
                xhr.responseType = 'json';
                xhr.onload = function () {
                    resolve(xhr.response);
                };
                xhr.send();
            })
            return prom;
        }
        let fs = []
        function shortcut(i, shell = new jssh(fs, '/', document.getElementsByClassName('window').length, 'null', 'null', window_create)) {
            shell.ex_file(i)
        }
        function close_menu() {
            let items = document.getElementsByClassName("bar-menu-item")
            for (let item = 0; item != items.length; item++) {
                let i_c = items.item(item).children
                for (let i = 0; i != i_c.length; i++) {
                    let id = i_c.item(i)
                    if (id.className == "bar-menu-more-root") {
                        id.style.display = "none"
                    }
                }
            }
            document.getElementById("bar-menu-root").style.display = "none"

            load_bar()
        }

        
        let fs_types;
        async function main() {
            fs = await req('src/fs.json')
            fs_types = await req('src/fs-types.json')
            fd = await util.fd({ path: '/', filetype: '*' })
            console.log(fd)
            document.getElementById("bar-menu").onclick = ((ev) => {
                if (document.getElementById("bar-menu-root").style.display == "block")
                    document.getElementById("bar-menu-root").style.display = "none"
                else
                    document.getElementById("bar-menu-root").style.display = "block"
            })
            load_bar()
        }
      

    </script>
</head>

<body onload="main()">
    <div id="root">
        <div id="bar">
            <div id="bar-children">
                <div id="bar-menu"><img src="./src/img/windows.png">
                    <pre> </pre>Start

                </div>
                <div id="bar-items">
                </div>


            </div>
        </div>
        <div id="bar-menu-root">
            <div class="bar-menu-item" id="bar-menu-windows-update"><img class="bar-menu-image"
                    src="./src/img/update.png">
                <div class="bar-menu-text">Windows Update</div>

            </div>
            <div class="bar-menu-separator"></div>
            <div class="bar-menu-item" id="bar-menu-programs" dir="/apps/"><img class="bar-menu-image"
                    src="./src/img/programs.png">
                <div class="bar-menu-text">Programs</div>
                <div class="bar-menu-more"></div>
                <div class="bar-menu-more-root">
                    <!--
                    <div class="bar-menu-item" id="bar-menu-favorites" shortcut-path=""><img class="bar-menu-image"
                            src="./src/img/notepad.png">
                        <div class="bar-menu-text">Notepad</div>
                    </div>
                    <div class="bar-menu-item" id="bar-menu-favorites"><img class="bar-menu-image"
                            src="./src/img/notepad.png">
                        <div class="bar-menu-text">Notepad--</div>
                    </div>-->
                </div>
            </div>
            <div class="bar-menu-item" id="bar-menu-favorites" dir="/fav/"><img class="bar-menu-image"
                    src="./src/img/favorites.png">
                <div class="bar-menu-text">Favorites</div>
                <div class="bar-menu-more"></div>
                <div class="bar-menu-more-root"></div>
            </div>
            <div class="bar-menu-item" id="bar-menu-docs" dir="/docs/"><img class="bar-menu-image"
                    src="./src/img/docs.png">
                <div class="bar-menu-text">Documents</div>
                <div class="bar-menu-more"></div>
                <div class="bar-menu-more-root"></div>
            </div>
            <div class="bar-menu-item" id="bar-menu-settings" dir="/settings/"><img class="bar-menu-image"
                    style="height:27px;padding-left:2px" src="./src/img/settings.png">
                <div class="bar-menu-text">Settings</div>
                <div class="bar-menu-more"></div>
                <div class="bar-menu-more-root"></div>
            </div>
            <div class="bar-menu-item" id="bar-menu-find" dir="/find/"><img class="bar-menu-image"
                    style="height:27px;padding-left:2px" src="./src/img/find.png">
                <div class="bar-menu-text">Find</div>
                <div class="bar-menu-more"></div>
                <div class="bar-menu-more-root"></div>
            </div>
            <div class="bar-menu-item" id="bar-menu-help"><img class="bar-menu-image" src="./src/img/help.png">
                <div class="bar-menu-text">Help</div>
            </div>
            <div class="bar-menu-item" id="bar-menu-run"><img class="bar-menu-image" src="./src/img/run.png">
                <div class="bar-menu-text">Run</div>
            </div>
            <div class="bar-menu-separator"></div>
            <div class="bar-menu-item" id="bar-menu-help"><img class="bar-menu-image" style="height:24px"
                    src="./src/img/log-off.png">
                <div class="bar-menu-text">Log Off...</div>
            </div>
            <div class="bar-menu-item" id="bar-menu-run" ><img class="bar-menu-image" style="height:24px"
                    src="./src/img/shut-down.png">
                <div class="bar-menu-text">Shut Down...</div>
            </div>
        </div>
    </div>
</body>

</html>